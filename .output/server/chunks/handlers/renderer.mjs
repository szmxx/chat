import{getRequestDependencies as e,getPreloadLinks as t,getPrefetchLinks as n,createRenderer as r}from"vue-bundle-renderer/runtime";import{h as s,j as o,k as a,m as i,o as d,p as l,q as u,v as p,u as c,x as f,y as h,z as m,A as y,B as b,r as _,c as x}from"../../index.mjs";import{stringify as v,uneval as C}from"devalue";import{renderToString as k}from"vue/server-renderer";import{renderSSRHead as T}from"@unhead/ssr";import{c as $,C as S}from"../index.mjs";import{version as L,unref as H}from"vue";import{defineHeadPlugin as P}from"@unhead/shared";function g(...e){return p(j(),c().app.buildAssetsDir,...e)}function j(...e){const t=c().app.cdnURL||c().app.baseURL;return e.length?p(t,...e):t}const M=L.startsWith("3");function R(e,t=""){if(e instanceof Promise)return e;const n=function(e){return"function"==typeof e?e():H(e)}(e);return e&&n?Array.isArray(n)?n.map((e=>R(e,t))):"object"==typeof n?Object.fromEntries(Object.entries(n).map((([e,t])=>"titleTemplate"===e||e.startsWith("on")?[e,H(t)]:[e,R(t,e)]))):n:n}const O=P({hooks:{"entries:resolve":function(e){for(const t of e.entries)t.resolvedInput=R(t.input)}}}),E="usehead";function ge(e={}){const t=$(e);return t.use(O),t.install=function(e){return{install(t){M&&(t.config.globalProperties.$unhead=e,t.config.globalProperties.$head=e,t.provide(E,e))}}.install}(t),t}const B=[S({track:!0})],D={link:[{rel:"icon",href:"/favicon.ico",sizes:"any"},{rel:"icon",type:"image/svg+xml",href:"/logo.svg"},{rel:"apple-touch-icon",href:"/apple-touch-icon.png"}],meta:[{charset:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1,maximum-scale=1.0,user-scalable=0"},{name:"description",content:"generator for wxchat"},{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"},{property:"og:type",content:"website"}],style:[],script:[],noscript:[],htmlAttrs:{lang:"en"}},W="__nuxt",q="div";globalThis.__buildAssetsURL=g,globalThis.__publicAssetsURL=j;const N=()=>import("../app/client.manifest.mjs").then((e=>e.default||e)).then((e=>"function"==typeof e?e():e)),z=w((()=>import("../app/styles.mjs").then((e=>e.default||e)))),X=w((async()=>{const e=await N();if(!e)throw new Error("client.manifest is not available");const t=await import("../app/server.mjs").then((e=>e.default||e));if(!t)throw new Error("Server bundle is not available");return r(t,{manifest:e,renderToString:async function(e,t){const n=await k(e,t);return`<${q} id="${W}">${n}</${q}>`},buildAssetsURL:g})})),G=w((async()=>{const e=await N(),t=await import("../rollup/_virtual_spa-template.mjs").then((e=>e.template)).catch((()=>"")),n=r((()=>()=>{}),{manifest:e,renderToString:()=>`<${q} id="${W}">${t}</${q}>`,buildAssetsURL:g}),s=await n.renderToString({});return{rendererContext:n.rendererContext,renderToString:e=>{const t=c();return e.modules=e.modules||new Set,e.payload={_errors:{},serverRendered:!1,data:{},state:{}},e.config={public:t.public,app:t.app},Promise.resolve(s)}}}));const J=/\/_payload(\.[a-zA-Z0-9]+)?.json(\?.*)?$/,F=new RegExp(`^<${q} id="${W}">([\\s\\S]*)</${q}>$`),Q=(Y=async r=>{const s=u(),o=r.path.startsWith("/__nuxt_error")?f(r):null;if(o&&o.statusCode&&(o.statusCode=parseInt(o.statusCode)),o&&!("__unenv__"in r.node.req))throw h({statusCode:404,statusMessage:"Page Not Found: /__nuxt_error"});const a=r.path.startsWith("/__nuxt_island")?await async function(e){let t=e.path||"";t=t.substring(15)||"";const[n,r]=t.split("?")[0].split("_"),s="GET"===e.method?f(e):await _(e);return{url:"/",...s,id:r,name:n,props:x(s.props)||{},uid:x(s.uid)||void 0}}(r):void 0;let d=o?.url||a?.url||r.path;const l=J.test(d)&&!a;l&&(d=d.substring(0,d.lastIndexOf("/"))||"/",r._path=d,r.node.req.url=d);const p=m(r),C=ge({plugins:B}),k={mode:"server"};C.push(D,k);const $={url:d,event:r,runtimeConfig:c(),noSSR:r.context.nuxt?.noSSR||!1===p.ssr&&!a||!1,head:C,error:!!o,nuxt:void 0,payload:o?{error:o}:{},_payloadReducers:{},islandContext:a},S=$.noSSR?await G():await X(),L=await S.renderToString($).catch((async e=>{if($._renderResponse&&"skipping render"===e.message)return{};const t=!o&&$.payload?.error||e;throw await($.nuxt?.hooks.callHook("app:error",t)),t}));if(await($.nuxt?.hooks.callHook("app:rendered",{ssrContext:$,renderResult:L})),$._renderResponse)return $._renderResponse;if($.payload?.error&&!o)throw $.payload.error;if(l)return function(e){return{body:v(Ee(e).payload,e._payloadReducers),statusCode:i(e.event),statusMessage:b(e.event),headers:{"content-type":"application/json;charset=utf-8","x-powered-by":"Nuxt"}}}($);const H=a?await async function(e){const t=await z(),n=new Set;for(const r of e)if(r in t)for(const e of await t[r]())n.add(e);return Array.from(n).map((e=>({innerHTML:e})))}($.modules??$._registeredComponents??[]):[],P=p.experimentalNoScripts,{styles:M,scripts:O}=e($,S.rendererContext);C.push({style:H}),C.push({link:Object.values(M).map((e=>({rel:"stylesheet",href:S.rendererContext.buildAssetsURL(e.file)})))},k),P||(C.push({link:t($,S.rendererContext)},k),C.push({link:n($,S.rendererContext)},k),C.push({script:Le({id:"__NUXT_DATA__",ssrContext:$,data:$.payload})},{...k,tagPosition:"bodyClose",tagPriority:"high"})),p.experimentalNoScripts||C.push({script:Object.values(O).map((e=>({type:e.module?"module":null,src:S.rendererContext.buildAssetsURL(e.file),defer:!e.module||null,crossorigin:""})))},k);const{headTags:E,bodyTags:W,bodyTagsOpen:q,htmlAttrs:F,bodyAttrs:Q}=await T(C),Y={island:!!a,htmlAttrs:[F],head:U([E,$.styles]),bodyAttrs:[Q],bodyPrepend:U([q,$.teleports?.body]),body:[je($,L.html)],bodyAppend:[W]};if(await s.hooks.callHook("render:html",Y,{event:r}),a){const e={link:[],style:[]};for(const t of await C.resolveTags())"link"===t.tag&&"stylesheet"===t.props.rel&&t.props.href.includes("scoped")&&!t.props.href.includes("pages/")&&e.link.push({...t.props,key:"island-link-"+y(t.props.href)}),"style"===t.tag&&t.innerHTML&&e.style.push({key:"island-style-"+y(t.innerHTML),innerHTML:t.innerHTML});const t={id:a.id,head:e,html:Oe(Y.body),state:$.payload.state};return await s.hooks.callHook("render:island",t,{event:r,islandContext:a}),{body:JSON.stringify(t,null,2),statusCode:i(r),statusMessage:b(r),headers:{"content-type":"application/json;charset=utf-8","x-powered-by":"Nuxt"}}}return{body:He(Y),statusCode:i(r),statusMessage:b(r),headers:{"content-type":"text/html;charset=utf-8","x-powered-by":"Nuxt"}}},s((async e=>{if(e.path.endsWith("/favicon.ico"))return o(e,"Content-Type","image/x-icon"),a(e,"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7");const t=await Y(e);if(!t){const t=i(e);return d(e,200===t?500:t),a(e,"No response returned from render handler: "+e.path)}return await u().hooks.callHook("render:response",t,{event:e}),t.headers&&l(e,t.headers),(t.statusCode||t.statusMessage)&&d(e,t.statusCode,t.statusMessage),"string"==typeof t.body?t.body:JSON.stringify(t.body)})));var Y;function w(e){let t=null;return()=>(null===t&&(t=e().catch((e=>{throw t=null,e}))),t)}function U(e){return e.filter(Boolean).map((e=>e.trim()))}function A(e){return e.join("")}function I(e){return e.join(" ")}function He(e){return`<!DOCTYPE html>\n<html ${I(e.htmlAttrs)}>\n<head>${A(e.head)}</head>\n<body ${I(e.bodyAttrs)}>${A(e.bodyPrepend)}${A(e.body)}${A(e.bodyAppend)}</body>\n</html>`}function Le(e){const t=e.data?v(e.data,e.ssrContext._payloadReducers):"",n={type:"application/json",id:e.id,innerHTML:t,"data-ssr":!e.ssrContext.noSSR};return e.src&&(n["data-src"]=e.src),[n,{innerHTML:`window.__NUXT__={};window.__NUXT__.config=${C(e.ssrContext.config)}`}]}function Ee(e){const{data:t,prerenderedAt:n,...r}=e.payload;return{initial:{...r,prerenderedAt:n},payload:{data:t,prerenderedAt:n}}}function Oe(e){const t=e[0].match(F);return t?t[1]:e[0]}const Z=/^uid=([^;]*);slot=(.*)$/;function je(e,t){const{teleports:n,islandContext:r}=e;if(r||!n)return t;for(const e in n){const r=e.match(Z);if(!r)continue;const[,s,o]=r;!s||!o||(t=t.replace(new RegExp(`<div nuxt-ssr-component-uid="${s}"[^>]*>((?!nuxt-ssr-slot-name="${o}"|nuxt-ssr-component-uid)[\\s\\S])*<div [^>]*nuxt-ssr-slot-name="${o}"[^>]*>`),(t=>t+n[e])))}return t}const K=Object.freeze({__proto__:null,default:Q});export{g as b,K as r};
